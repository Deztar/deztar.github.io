import{_ as P}from"./C0bnqowU.js";import{e as V,r as _,f as W,g as x,h as F,c as i,a as n,b as E,u as s,i as w,K as I,F as p,k as f,m as b,o as c,t as h,n as H,d as R,l as j}from"./CrL4dOpj.js";import{u as z}from"./KtNaZX65.js";const G={id:"wtw-army-planner",class:"fc1",style:{margin:"1ch"}},K={class:"fr jc ac"},Q={class:"container"},X={class:"table"},Y=["onClick"],Z={class:"controls"},tt=["value","onInput"],et=["onClick"],nt=["onClick"],lt=["colspan"],ot={key:0,class:"quantity"},st={class:"unit"},at={key:0,class:"editor fc bs"},ut={class:"row"},rt=["value"],it={class:"row"},ct=["value"],dt={key:0,class:"border"},mt={class:"row"},vt=["value","onInput","onContextmenu"],pt=["value","onInput","list"],yt=["id"],ft=["value"],kt=V({__name:"wtw-army-planner",setup(ht){z({title:"Warhammer Army Planner",meta:[{name:"description",content:"Warhammer Army Planner"}]});const k=["Training 1","Scouting 1","Healing 1","Mobility 1","Scavenge 1","Infantry 1","Infantry 2","Infantry 3","Infantry 4","Infantry 5","Cavalry 1","Cavalry 2","Chariot 1","Beasts 1","Monster 1","Monster 2","Monster 3","Monster 4","War Machine 1","Artillery 1","Artillery 2"],q=(e=[])=>{const t=k.map(a=>({type:a,quantity:0,name:""}));for(let a of e){const l=t.find(u=>u.type===a.type);l&&(l.quantity=a.quantity,l.name=a.name)}return t};let A;const m=_(!1),y=_(!1),o=_([]),d=_(0),C=["Infantry 1","Cavalry 1","Monster 1","War Machine 1"],M=[];for(let e=0,t=k.length,a=0;e<t;e++)C.includes(k[e])&&a++,M[e]=a;const S=()=>{const e=JSON.parse(localStorage.getItem("wtw-data")||"{}");o.value=e.armies||[],o.value.length===0&&N(),o.value.forEach(t=>{t.units=q(t.units)}),m.value=e.editMode!==void 0?e.editMode:!0,y.value=e.autocompleteMode!==void 0?e.editMode:!0},g=()=>{const e=[];o.value.forEach(t=>{e.push({...t,units:t.units.filter(a=>a.quantity>0||a.name.length>0)})}),localStorage.setItem("wtw-data",JSON.stringify({armies:e,editMode:m.value,autocompleteMode:y.value}))},T=(e,t)=>{e.target&&e.target.tagName==="BUTTON"||(d.value=t)},N=()=>{o.value.push({culture:"",lord:"",units:q()}),d.value=o.value.length-1},L=e=>{o.value.splice(e,1),d.value>o.value.length-1&&(d.value=o.value.length-1),o.value.length===0&&N()},$=(e,t)=>{clearTimeout(A),A=window.setTimeout(()=>{var l;const a=o.value[e];o.value.splice(e,1),o.value.splice(t,0,a),d.value=t,((l=document.activeElement)==null?void 0:l.tagName)==="INPUT"&&document.activeElement.blur()},500)},B=e=>{const t=JSON.parse(JSON.stringify(o.value[e]));o.value.push(t)},O=()=>{o.value.sort((e,t)=>2*e.culture.localeCompare(t.culture)+e.lord.localeCompare(t.lord))},U=e=>isNaN(+e.slice(-1))?e:e.slice(0,-2),D=W(()=>{const e=[];for(let t=0,a=C.length+1;t<a;t++)e[t]=[];return y.value===!0&&o.value.forEach(t=>{t.units.forEach((a,l)=>{a.name&&e[M[l]].push(a.name)})}),e}),J=e=>`unit-list-${M[e]}`;return x(()=>{S(),addEventListener("beforeunload",g)}),F(()=>{removeEventListener("beforeunload",g),g()}),(e,t)=>{const a=P;return c(),i("div",G,[n("div",K,[n("button",{onClick:g},"Save"),n("button",{onClick:N},"Add"),n("button",{onClick:O},"Sort"),n("button",{onClick:S},"Restore"),t[4]||(t[4]=n("label",null,"Edit Mode:",-1)),E(a,{checked:s(m),onClick:t[0]||(t[0]=l=>m.value=!s(m))},null,8,["checked"]),t[5]||(t[5]=n("label",null,"Autocomplete:",-1)),E(a,{checked:s(y),onClick:t[1]||(t[1]=l=>y.value=!s(y))},null,8,["checked"])]),n("div",Q,[n("table",X,[n("thead",null,[n("tr",null,[w(n("th",null,"Controls",512),[[I,s(m)]]),t[6]||(t[6]=n("th",null,"Culture",-1)),t[7]||(t[7]=n("th",null,"Lord",-1)),(c(),i(p,null,f(19,l=>n("th",{key:l},h(l+1),1)),64))])]),n("tbody",null,[(c(!0),i(p,null,f(s(o),(l,u)=>(c(),i("tr",{key:u,class:H({selected:s(m)&&s(d)===u}),onClick:r=>T(r,u)},[w(n("td",Z,[n("input",{title:"Position in array",class:"number-short dim",type:"number",value:u,onInput:r=>{var v;return $(u,+((v=r.target)==null?void 0:v.value))}},null,40,tt),n("button",{class:"delete",onClick:r=>B(u)},"c",8,et),n("button",{class:"delete",onClick:r=>L(u)},"x",8,nt)],512),[[I,s(m)]]),n("td",null,h(l.culture),1),n("td",null,h(l.lord),1),(c(!0),i(p,null,f(l.units,r=>(c(),i(p,{key:r.type},[r.quantity>0?(c(),i("td",{key:0,class:"field",colspan:r.quantity},[r.quantity>1?(c(),i("span",ot,[R(h(r.quantity)+" x",1),t[8]||(t[8]=n("br",null,null,-1))])):b("",!0),n("span",st,h(r.name),1)],8,lt)):b("",!0)],64))),128))],10,Y))),128))])]),s(o).length>0&&s(o)[s(d)]?w((c(),i("div",at,[n("div",ut,[t[9]||(t[9]=n("label",null,"Culture",-1)),n("input",{title:"Culture",class:"name header",type:"text",value:s(o)[s(d)].culture,onInput:t[2]||(t[2]=l=>{var u;return s(o)[s(d)].culture=(u=l.target)==null?void 0:u.value})},null,40,rt)]),t[11]||(t[11]=n("div",{class:"border"},null,-1)),n("div",it,[t[10]||(t[10]=n("label",null,"Lord",-1)),n("input",{title:"Lord",class:"name header",type:"text",value:s(o)[s(d)].lord,onInput:t[3]||(t[3]=l=>{var u;return s(o)[s(d)].lord=(u=l.target)==null?void 0:u.value})},null,40,ct)]),(c(!0),i(p,null,f(s(o)[s(d)].units,(l,u)=>(c(),i(p,{key:l.type},[C.includes(l.type)?(c(),i("div",dt)):b("",!0),n("div",mt,[n("label",null,h(U(l.type)),1),n("input",{title:"Number of units",class:"number-short quantity",type:"number",value:l.quantity,onInput:r=>{var v;return l.quantity=+((v=r.target)==null?void 0:v.value)},onContextmenu:j(r=>l.quantity=0,["prevent"])},null,40,vt),n("input",{title:"Unit name",class:"name",type:"text",value:l.name,onInput:r=>{var v;return l.name=(v=r.target)==null?void 0:v.value},list:J(u)},null,40,pt)])],64))),128)),(c(!0),i(p,null,f(s(D),(l,u)=>(c(),i("datalist",{id:`unit-list-${u}`},[(c(!0),i(p,null,f(l,r=>(c(),i("option",{value:r},null,8,ft))),256))],8,yt))),256))],512)),[[I,s(m)]]):b("",!0)])])}}});export{kt as default};
